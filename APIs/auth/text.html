<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
</head>
<body>
<input id="file-selector" type="file">
<p></p>
</body>


<script src="cos-js-sdk-v5.min.js"></script>
<script src="http://upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.3.min.js"></script>
<script>
var Bucket = 'auth-1254095611';
var Region = 'ap-guangzhou';

// 初始化实例
var cos = new COS({
    getAuthorization: function (options, callback) {
////         异步获取签名
//         $.get('../server/auth.php', {
//             method: (options.Method || 'get').toLowerCase(),
//             pathname: '/' + (options.Key || '')
//         }, function (authorization) {
//             callback(authorization);
//         }, 'text');

//         // 方法二、后端通过获取临时密钥，计算签名给到前端（适用于前端调试）
//         var method = (options.Method || 'get').toLowerCase();
//         var key = options.Key || '';
//         var query = options.Query || {};
//         var headers = options.Headers || {};
//         var pathname = key.indexOf('/') === 0 ? key : '/' + key;
//         // var url = 'http://127.0.0.1:3000/sts';
//         var url = 'http://my.liziwl.cn:5000/sign';
//         var xhr = new XMLHttpRequest();
//         var data = {
//             method: method,
//             pathname: pathname,
//             query: query,
//             headers: headers,
//         };
//         xhr.open('GET', url, true);
//         xhr.setRequestHeader('content-type', 'application/json');
//         xhr.onload = function (e) {
//             try {
//                 var AuthData = JSON.parse(e.target.responseText);
//             } catch (e) {
//             }
//             callback({
//                 Authorization: AuthData.authorization,
//                 XCosSecurityToken: AuthData.sessionToken,
//             });
//         };
//         xhr.send(JSON.stringify(data));
        var req = new XMLHttpRequest();
        req.overrideMimeType("application/json");
        var url = 'http://my.liziwl.cn:5000/sign';
        req.open('GET', url, true);
        req.onload  = function() {
            var jsonResponse = JSON.parse(req.responseText);
            // do something with jsonResponse
            alert(JSON.stringify(jsonResponse));
        };
        req.send(null);


    }
});

// 监听选文件
document.getElementById('file-selector').onchange = function () {

    var file = this.files[0];
    if (!file) return;

    // 分片上传文件
    cos.sliceUploadFile({
        Bucket: Bucket,
        Region: Region,
        Key: file.name,
        Body: file,
    }, function (err, data) {
        console.log(err, data);
    });

};
</script>